<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
  }

  section {
    min-height: 120vh;
    padding: 12vh 10vw;
    font-size: clamp(28px, 4vw, 56px);
  }

  .s1 { background: #fff; }
  .s2 { background: #f2f2f2; }
  .s3 { background: #111; color: #fff; }

  /* mot cible */
  .impact {
    display: inline-block;
    position: relative;
    font-weight: 700;
  }

  /* bouteille flottante */
  model-viewer {
    position: fixed;
    left: 62%;
    top: 50%;
    width: 320px;
    height: 520px;
    transform: translateY(-50%);
    pointer-events: none;
    z-index: 30;
  }
</style>
</head>

<body>

<section class="s1">
  <h1>La bouteille arrive</h1>
</section>

<section class="s2">
  <p>
    Elle rebondit sur ce
    <span class="impact" id="impactWord">mot</span>
    prÃ©cis.
  </p>
</section>

<section class="s3">
  <p>Et remonte quand on rescrolle ðŸ‘†</p>
</section>

<model-viewer
  id="bottle"
  src="growthbottle.glb"
  interaction-prompt="none"
    camera-orbit="0deg 75deg 10.6m"

>
</model-viewer>

<script>
  const mv = document.getElementById("bottle");
  const impactWord = document.getElementById("impactWord");

  function clamp01(x) {
    return Math.min(1, Math.max(0, x));
  }

  // chute lourde : accÃ©lÃ©ration marquÃ©e
  function easeInHeavy(t) {
    return t * t * t;
  }

  function update() {
    const scrollY = window.scrollY;
    const docH = document.body.scrollHeight - window.innerHeight;
    const p = clamp01(scrollY / docH);
    const e = easeInHeavy(p);

    /* =========================
       CHUTE VERTICALE (LOURDE)
    ========================= */
    const fallDistance = window.innerHeight * 1.2;
    let y = -fallDistance / 2 + e * fallDistance;

    /* =========================
       DÃ‰PLACEMENT HORIZONTAL
       (glissement lent)
    ========================= */
    const x = Math.sin(p * Math.PI) * 80;

    /* =========================
       POSITION DU MOT
    ========================= */
    const rect = impactWord.getBoundingClientRect();
    const wordY =
      rect.top +
      rect.height / 2 -
      window.innerHeight / 2;

    /* =========================
       IMPACT LOURD
    ========================= */
    const impactRadius = 32;
    const impactZone = Math.abs(y - wordY) < impactRadius;

    if (impactZone) {
      // arrÃªt net + petit rebond sec
      const compression = (impactRadius - Math.abs(y - wordY)) * 0.4;
      y = wordY - impactRadius + compression;
    }

    /* =========================
       APPLICATION POSITION
    ========================= */
    mv.style.transform =
      `translate(${x}px, calc(-50% + ${y}px))`;

    /* =========================
       ROTATION LOURDE (FREINÃ‰E)
    ========================= */
    const rotY = p * 540; // moins de tours
    const slow = impactZone ? 0.25 : 1;
    const tilt = Math.sin(p * Math.PI) * 6;

    mv.cameraOrbit =
      `${rotY * slow}deg ${75 + tilt}deg 10.6m`;

    requestAnimationFrame(update);
  }

  mv.addEventListener("load", update);
  window.addEventListener("resize", update);
</script>

</body>
</html>
