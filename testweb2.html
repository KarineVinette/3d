<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    overflow-x: hidden;
  }

  section {
    min-height: 120vh;
    padding: 12vh 10vw;
    font-size: clamp(28px, 4vw, 56px);
  }

  .s1 { background: #fff; }
  .s2 { background: #f2f2f2; }
  .s3 { background: #111; color: #fff; }

  model-viewer {
    position: fixed;
    left: 62%;
    top: 80%;
    width: 320px;
    height: 520px;
    pointer-events: none;
    z-index: 30;
  }
</style>
</head>

<body>

<section class="s1">
  <h1>La bouteille arrive</h1>
</section>

<section class="s2">
  <p>
    Elle traverse la page,
    va Ã  gauche,
    puis revient Ã  droite.
  </p>
</section>

<section class="s3">
  <p>Scroll â†‘ / â†“ pour rejouer lâ€™animation</p>
</section>

<model-viewer
  id="bottle"
  src="growthbottle.glb"
  interaction-prompt="none"
  camera-orbit="0deg 75deg 12m"
>
</model-viewer>

<script>
  const mv = document.getElementById("bottle");

  function clamp01(x) {
    return Math.min(1, Math.max(0, x));
  }

  // chute lourde, progressive
  function easeHeavy(t) {
    return t * t * t;
  }

  function update() {
    const scrollY = window.scrollY;
    const maxScroll =
      document.body.scrollHeight - window.innerHeight;

    const p = clamp01(scrollY / maxScroll);
    const e = easeHeavy(p);

    /* =========================
       POSITION VERTICALE
       (ENTIÃˆREMENT VISIBLE)
    ========================= */
    const modelHeight = 520; // hauteur CSS du model-viewer
    const startY = -window.innerHeight / 2 - modelHeight / 2;
    const endY = window.innerHeight / 2 - modelHeight / 2;

    const y = startY + e * (endY - startY);

    /* =========================
       MOUVEMENT HORIZONTAL
       droite â†’ gauche â†’ droite
    ========================= */
    const maxShift = window.innerWidth * 0.45;
    const v = 1 - Math.abs(1 - 2 * p);
    const x = maxShift * (1 - 2 * v);

    /* =========================
       APPLICATION POSITION
    ========================= */
    mv.style.transform =
      `translate(${x}px, ${y}px)`;

    /* =========================
       ROTATION LENTE & LOURDE
    ========================= */
    const rotY = p * 300; // ðŸ‘ˆ BEAUCOUP PLUS LENT
    const tilt = Math.sin(p * Math.PI) * 4;

    mv.cameraOrbit =
      `${rotY}deg ${75 + tilt}deg 12m`;

    requestAnimationFrame(update);
  }

  mv.addEventListener("load", update);
  window.addEventListener("resize", update);
</script>

</body>
</html>
